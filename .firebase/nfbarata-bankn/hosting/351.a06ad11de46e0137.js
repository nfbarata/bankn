"use strict";(self.webpackChunkbankn=self.webpackChunkbankn||[]).push([[351],{9351:(vt,Z,_)=>{_.r(Z),_.d(Z,{TransactionModule:()=>Rt});var A=_(6895),c=_(433),d=_(4736),h=_(4666),L=_(6808),$=_(3933),p=_(7818),t=_(8256),I=_(106),O=_(8164),U=_(5177),G=_(3615),Y=_(9080),x=_(6719),F=_(8071),D=_(2200),y=_(7106);function q(r,i){1&r&&(t.TgZ(0,"div",0)(1,"div",7),t._UZ(2,"account-create-card"),t.qZA()())}function J(r,i){1&r&&(t.TgZ(0,"div",0)(1,"div",7),t._UZ(2,"account-select-card"),t.qZA()())}function X(r,i){1&r&&(t.TgZ(0,"div",0)(1,"div",7),t._UZ(2,"transaction-create-card"),t.qZA(),t.TgZ(3,"div",8),t._uU(4," \xa0 "),t.qZA(),t.TgZ(5,"div",7),t._UZ(6,"transactions-import-card"),t.qZA()())}function B(r,i){if(1&r&&(t.TgZ(0,"tr",13)(1,"th",18),t._uU(2),t.ALo(3,"date"),t.qZA(),t._UZ(4,"th",19),t.TgZ(5,"th",20),t._uU(6),t.ALo(7,"dinero"),t.qZA()()),2&r){const s=t.oxw().$implicit;t.xp6(2),t.hij("",t.xi3(3,2,s.date,"shortDate"),"\xa0"),t.xp6(4),t.hij("",t.lcZ(7,5,s.balanceAfter),"\xa0")}}const k=function(r){return[r]};function Q(r,i){if(1&r&&(t.TgZ(0,"tr",21)(1,"td"),t._uU(2),t.ALo(3,"category"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td",15),t._uU(7),t.ALo(8,"transaction"),t.qZA()()),2&r){const s=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(8,k,"/transactions/transaction/"+s.account.id+"/"+s.id)),t.xp6(2),t.hij("",t.lcZ(3,4,s.category),"\xa0"),t.xp6(3),t.hij("",s.description,"\xa0"),t.xp6(2),t.Oqu(t.lcZ(8,6,s))}}function w(r,i){if(1&r&&(t.ynx(0),t.YNc(1,B,8,7,"tr",16),t.YNc(2,Q,9,10,"tr",17),t.BQk()),2&r){const s=i.$implicit,n=i.index,o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",1!=s.hide&&(0==n||n>0&&s.date.getTime()!=o.transactions[n-1].date.getTime())),t.xp6(1),t.Q6J("ngIf",1!=s.hide)}}function z(r,i){if(1&r&&(t.TgZ(0,"div",9)(1,"table",10)(2,"tbody"),t.YNc(3,w,3,2,"ng-container",11),t.qZA(),t.TgZ(4,"tfoot",12)(5,"tr",13)(6,"td",14),t._uU(7,"Initial value"),t.qZA(),t.TgZ(8,"td",15),t._uU(9),t.ALo(10,"dinero"),t.qZA()()()()()),2&r){const s=t.oxw();t.xp6(3),t.Q6J("ngForOf",s.transactions),t.xp6(6),t.Oqu(t.lcZ(10,2,s.initialBalance))}}const H=function(){return["/transactions/transaction"]};let b=(()=>{const i=class{constructor(n,o,e){this.route=n,this.eventsService=o,this.accountService=e,this.hasRealTransactions=!1,this.transactions=[],this.initialBalance=null,this.selectedAccounts=[],this.accounts=[]}ngOnInit(){this.refreshAccounts(),this.eventsService.accountSelectionChange.subscribe(()=>this.refreshData()),this.eventsService.accountsChange.subscribe(()=>this.refreshAccounts()),this.route.paramMap.subscribe(n=>{var o=n.get("accountId");null==o||0==o.trim().length||this.accounts.forEach(e=>{e.id==o?this.accountService.selectAccount(e):e.selected&&this.accountService.toggleAccount(e)})})}refreshData(){for(;this.transactions.length>0;)this.transactions.pop();this.hasRealTransactions=!1;var n=[];if(this.selectedAccounts=this.accountService.getSelectedAccounts(),this.selectedAccounts.length>0){this.selectedAccounts.forEach(e=>{n=n.concat(e.transactions),!this.hasRealTransactions&&e.transactions.length>0&&(this.hasRealTransactions=!0)});let o=this.accountService.getInitialValueMultiple(this.selectedAccounts);h.p.sortTransactions(n),this.applyBalanceToTransactions(n,o),this.transactions=n,this.initialBalance=this.transactions.length>0?this.transactions[this.transactions.length-1].balanceBefore:null}}refreshAccounts(){this.accounts=this.accountService.getAccounts(),this.refreshData()}applyBalanceToTransactions(n,o){var e=o;for(let a=n.length-1;a>=0;a--){switch(n[a].balanceBefore=e,n[a].type){case p.iU.CREDIT:e=(0,L.I)(e,n[a].amount);break;case p.iU.DEBIT:e=(0,$.$)(e,n[a].amount)}n[a].balanceAfter=e}}};let r=i;return i.\u0275fac=function(o){return new(o||i)(t.Y36(d.gz),t.Y36(I.n),t.Y36(O.B))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-transaction-list"]],decls:12,vars:7,consts:function(){let n;return n=$localize`Transactions`,[[1,"row"],[1,"col-6"],n,[1,"col-6","text-right"],["type","submit",1,"btn","btn-primary",3,"routerLink","disabled"],["class","row",4,"ngIf"],["class","table-responsive text-nowrap",4,"ngIf"],[1,"col-sm-5"],[1,"col-sm-2"],[1,"table-responsive","text-nowrap"],[1,"table","table-sm","table-hover"],[4,"ngFor","ngForOf"],[1,"table-group-divider"],[1,"table-active"],["colspan","2",1,""],["scope","row",1,"text-end"],["class","table-active",4,"ngIf"],[3,"routerLink",4,"ngIf"],["scope","col","width","20%"],["scope","col","width","70%"],["scope","col","width","10%",1,"text-end"],[3,"routerLink"]]},template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2"),t.SDv(3,2),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t._uU(6," New "),t.qZA()()(),t._UZ(7,"br"),t.YNc(8,q,3,0,"div",5),t.YNc(9,J,3,0,"div",5),t.YNc(10,X,7,0,"div",5),t.YNc(11,z,11,4,"div",6)),2&o&&(t.xp6(5),t.Q6J("routerLink",t.DdM(6,H))("disabled",0==e.accounts.length),t.xp6(3),t.Q6J("ngIf",0==e.accounts.length),t.xp6(1),t.Q6J("ngIf",e.accounts.length>0&&0==e.selectedAccounts.length),t.xp6(1),t.Q6J("ngIf",e.accounts.length>0&&e.selectedAccounts.length>0&&!e.hasRealTransactions),t.xp6(1),t.Q6J("ngIf",e.hasRealTransactions))},dependencies:[A.sg,A.O5,d.rH,U.x,G.Q,Y.G,x._,A.uU,F.L,D.M,y.y]}),r})();var M=_(9865);const j=["importData"],V=["columnSeparator"],K=["lineSeparator"],W=["customColumnSeparator"],tt=["customLineSeparator"],et=["parsedData"],nt=["submitHelpBlock"];let ot=(()=>{const i=class{constructor(n,o,e,a,T,u,N,S,m){this.renderer=n,this.eventsService=o,this.banknService=e,this.accountService=a,this.transactionService=T,this.formBuilder=u,this.route=N,this.router=S,this.location=m,this.submitDisabled=!0,this.accountId=null,this.formData={importData:null,columnSeparator:"9",lineSeparator:"10",customColumnSeparator:"",customLineSeparator:""},this.form=this.formBuilder.group(this.formData)}ngAfterViewInit(){}ngOnInit(){this.transactionService.importTransactions=[],this.route.paramMap.subscribe(n=>{this.accountId=n.get("accountId")})}onSubmit(n){this.transactionService.importTransactions=this.output,this.form.reset(),this.router.navigate(["/transactions/import-filter/"+this.accountId])}setMessage(n){this.renderer.setProperty(this.submitHelpBlock.nativeElement,"innerHTML",n)}onInputChange(){var n,o;if(this.clearTable(),this.submitDisabled=!0,""==this.lineSeparator.nativeElement.value){if(0==(n=this.customLineSeparator.nativeElement.value).trim().length)return void this.setMessage("Insert some value at row separator")}else n=String.fromCharCode(this.lineSeparator.nativeElement.value);if(""==this.columnSeparator.nativeElement.value){if(0==(o=this.customColumnSeparator.nativeElement.value).trim().length)return void this.setMessage("Insert some value at column separator")}else o=String.fromCharCode(this.columnSeparator.nativeElement.value);try{var e=this.transactionService.parse(this.importData.nativeElement.value,n,o);this.setMessage("Check the data below before import"),this.fillTable(e),this.submitDisabled=!1}catch(a){this.setMessage(a)}}clearTable(){this.output=null,this.renderer.setProperty(this.parsedData.nativeElement,"innerHTML","")}fillTable(n){this.output=n,n.forEach(o=>{var e=this.renderer.createElement("tr");this.renderer.appendChild(this.parsedData.nativeElement,e),o.forEach(a=>{var T=this.renderer.createElement("td");this.renderer.appendChild(e,T),this.renderer.setProperty(T,"innerHTML",a)})})}};let r=i;return i.\u0275fac=function(o){return new(o||i)(t.Y36(t.Qsj),t.Y36(I.n),t.Y36(M.D),t.Y36(O.B),t.Y36(h.p),t.Y36(c.QS),t.Y36(d.gz),t.Y36(d.F0),t.Y36(A.Ye))},i.\u0275cmp=t.Xpm({type:i,selectors:[["transaction-import"]],viewQuery:function(o,e){if(1&o&&(t.Gf(j,5),t.Gf(V,5),t.Gf(K,5),t.Gf(W,5),t.Gf(tt,5),t.Gf(et,5),t.Gf(nt,5)),2&o){let a;t.iGM(a=t.CRH())&&(e.importData=a.first),t.iGM(a=t.CRH())&&(e.columnSeparator=a.first),t.iGM(a=t.CRH())&&(e.lineSeparator=a.first),t.iGM(a=t.CRH())&&(e.customColumnSeparator=a.first),t.iGM(a=t.CRH())&&(e.customLineSeparator=a.first),t.iGM(a=t.CRH())&&(e.parsedData=a.first),t.iGM(a=t.CRH())&&(e.submitHelpBlock=a.first)}},decls:59,vars:4,consts:function(){let n,o,e;return n=$localize` External transactions: `,o=$localize`Copy paste data from your homebanking`,e=$localize`Import`,[[1,"container",3,"formGroup","ngSubmit"],[1,"row"],["mwlTextInputHighlightContainer","",1,"col-12","form-group"],["for","importData"],n,["formControlName","importData","id","importData","wrap","off","rows","6",1,"form-control",3,"keyup","paste"],["importData",""],["id","importDataHelpBlock",1,"form-text","text-muted"],o,[1,"col-6","form-group"],["title","columnSeparator","formControlName","columnSeparator",1,"form-control",3,"change"],["columnSeparator",""],["value","9"],["value","44"],["value","59"],["value","32"],["value",""],["title","lineSeparator","formControlName","lineSeparator",1,"form-control",3,"change"],["lineSeparator",""],["value","10"],["title","customColumnSeparator","formControlName","customColumnSeparator",1,"form-control",3,"hidden","keyup","paste"],["customColumnSeparator",""],["id","customColumnSeparatorHelpBlock",1,"form-text","text-muted",3,"change"],["title","customLineSeparator","formControlName","customLineSeparator",1,"form-control",3,"hidden","keyup","paste"],["customLineSeparator",""],["id","lineSeparatorHelpBlock",1,"form-text","text-muted",3,"change"],[1,"col-12"],["type","submit",1,"btn","btn-primary",3,"disabled"],e,["id","submitHelpBlock",1,"form-text","text-muted"],["submitHelpBlock",""],[1,"table-responsive-xl"],[1,"table","table-sm","table-bordered","small","font-weight-lighter","text-truncate"],["id","parsedData"],["parsedData",""]]},template:function(o,e){if(1&o&&(t.TgZ(0,"h2"),t._uU(1,"Import transactions"),t.qZA(),t._UZ(2,"br"),t.TgZ(3,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit(e.form.value)}),t.TgZ(4,"div",1)(5,"div",2)(6,"label",3),t.SDv(7,4),t.qZA(),t._UZ(8,"br"),t.TgZ(9,"textarea",5,6),t.NdJ("keyup",function(){return e.onInputChange()})("paste",function(){return e.onInputChange()}),t.qZA(),t.TgZ(11,"small",7),t.SDv(12,8),t.qZA()()(),t.TgZ(13,"div",1)(14,"div",9)(15,"select",10,11),t.NdJ("change",function(){return e.onInputChange()}),t.TgZ(17,"option",12),t._uU(18,"tab"),t.qZA(),t.TgZ(19,"option",13),t._uU(20,"comma"),t.qZA(),t.TgZ(21,"option",14),t._uU(22,"semicolon"),t.qZA(),t.TgZ(23,"option",15),t._uU(24,"space"),t.qZA(),t.TgZ(25,"option",16),t._uU(26,"custom"),t.qZA()()(),t.TgZ(27,"div",9)(28,"select",17,18),t.NdJ("change",function(){return e.onInputChange()}),t.TgZ(30,"option",19),t._uU(31,"\\n"),t.qZA(),t.TgZ(32,"option",16),t._uU(33,"custom"),t.qZA()()()(),t.TgZ(34,"div",1)(35,"div",9)(36,"input",20,21),t.NdJ("keyup",function(){return e.onInputChange()})("paste",function(){return e.onInputChange()}),t.qZA(),t.TgZ(38,"small",22),t.NdJ("change",function(){return e.onInputChange()}),t._uU(39,"Column separator"),t.qZA()(),t.TgZ(40,"div",9)(41,"input",23,24),t.NdJ("keyup",function(){return e.onInputChange()})("paste",function(){return e.onInputChange()}),t.qZA(),t.TgZ(43,"small",25),t.NdJ("change",function(){return e.onInputChange()}),t._uU(44,"Row separator"),t.qZA()()(),t.TgZ(45,"div",1)(46,"div",26)(47,"button",27),t.SDv(48,28),t.qZA(),t.TgZ(49,"small",29,30),t._uU(51,"Enter some text to import"),t.qZA()()()(),t._UZ(52,"br"),t.TgZ(53,"div",1)(54,"div",26)(55,"div",31)(56,"table",32),t._UZ(57,"tbody",33,34),t.qZA()()()()),2&o){const a=t.MAs(16),T=t.MAs(29);t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(33),t.Q6J("hidden",""!=a.value),t.xp6(5),t.Q6J("hidden",""!=T.value),t.xp6(6),t.Q6J("disabled",e.submitDisabled)}},dependencies:[c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.sg,c.u]}),r})();var it=_(673),rt=_(5081),at=_(5008),st=_(8308),ct=_(3981);const lt=["submitHelpBlock"];function _t(r,i){if(1&r&&(t.TgZ(0,"option",14),t._uU(1),t.ALo(2,"importColumnType"),t.qZA()),2&r){const s=i.$implicit;t.s9C("value",s),t.xp6(1),t.Oqu(t.lcZ(2,2,s))}}function Tt(r,i){if(1&r&&(t.TgZ(0,"th")(1,"select",12),t.YNc(2,_t,3,4,"option",13),t.qZA()()),2&r){const s=i.index,n=t.oxw();t.xp6(1),t.MGl("id","action",s,""),t.xp6(1),t.Q6J("ngForOf",n.importColumnTypes)}}function ut(r,i){if(1&r&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&r){const s=i.$implicit;t.xp6(1),t.hij(" ",s," ")}}function Nt(r,i){if(1&r&&(t.TgZ(0,"tr")(1,"td")(2,"div",15),t._UZ(3,"input",16)(4,"label",17),t.qZA()(),t.YNc(5,ut,2,1,"td",7),t.qZA()),2&r){const s=i.$implicit,n=i.index;t.xp6(3),t.MGl("id","dontIgnore",n,""),t.xp6(1),t.MGl("for","dontIgnore",n,""),t.xp6(1),t.Q6J("ngForOf",s)}}const pt=function(){return[]};let St=(()=>{const i=class{constructor(n,o,e,a,T,u,N,S,m,g){this.renderer=n,this.eventsService=o,this.banknService=e,this.accountService=a,this.transactionService=T,this.formBuilder=u,this.route=N,this.router=S,this.location=m,this.importColumnTypes=Object.values(p.S_),this.account=null,this.transactions=null,this.submitDisabled=!1,this.document=g,this.formData={importData:null},this.form=this.formBuilder.group(this.formData)}ngAfterViewInit(){}ngOnInit(){this.account=null,this.transactions=this.transactionService.importTransactions,this.route.paramMap.subscribe(n=>{var o=n.get("accountId");null==o?this.router.navigate([""]):(this.account=this.accountService.getAccount(o),null==this.account?this.router.navigate([""]):(null==this.transactions||0==this.transactions.length)&&(alert("No transactions to import"),this.router.navigate(["/transactions/import/"+this.account.id])))})}getDate(n){return(n=n.replace("/","-")).split("-")}normalize(n){return n.replace(",",".")}getYear(n){return 4==n.length?n:n>80?"19"+n:"20"+n}onSubmit(n){if(null!=this.account&&null!=this.transactions&&this.transactions.length>0){this.transactionService.filterActions=[];var o=this.transactions[0];o.forEach((e,a)=>{var T=this.document.getElementById("action"+a);null!=T&&this.transactionService.filterActions.push(T.value)}),this.transactionService.filterTransactions=[];try{this.transactions.forEach((e,a)=>{var T=this.document.getElementById("dontIgnore"+a);if(null!=this.account&&T.checked){var u=null,N=null,S=null,m=p.iU.CREDIT;if(o.forEach((P,f)=>{var l=e[f];switch(this.transactionService.filterActions[f]){case p.S_.IGNORE:break;case p.S_.DESCRIPTION:S=l;break;case p.S_.DATE_DMY:l=this.getDate(l),N=new Date(this.getYear(l[2]),l[1]-1,l[0]);break;case p.S_.DATE_MDY:l=this.getDate(l),N=new Date(this.getYear(l[2]),l[0]-1,l[1]);break;case p.S_.DATE_YMD:l=this.getDate(l),N=new Date(this.getYear(l[0]),l[1]-1,l[2]);break;case p.S_.AMOUNT:l.includes("-")&&(l=l.replace("-",""),m=p.iU.DEBIT),u=this.normalize(l);break;case p.S_.CREDIT:u=this.normalize(l);break;case p.S_.DEBIT:u=this.normalize(l),m=p.iU.DEBIT;break;case p.S_.SIGN:"-"==l.trim()&&(m=p.iU.DEBIT)}}),null==u||null==N||null==S)throw new Error("There should be at least a column for amount, date and description");var g=at.H.getCategoryFromDescription(this.banknService.getBankn(),S),C=st.c.getEntityFromDescription(this.banknService.getBankn(),S,g);this.transactionService.filterTransactions.push(new it.Y(rt.h.UUID(),this.accountService.fromInputValue(u,this.account),m,N,C??void 0,g??void 0,"",S,this.account))}})}catch(e){return void this.setMessage(e)}this.form.reset(),this.router.navigate(["/transactions/import-edit/"+this.account.id])}}setMessage(n){this.renderer.setProperty(this.submitHelpBlock.nativeElement,"innerHTML",n)}};let r=i;return i.\u0275fac=function(o){return new(o||i)(t.Y36(t.Qsj),t.Y36(I.n),t.Y36(M.D),t.Y36(O.B),t.Y36(h.p),t.Y36(c.QS),t.Y36(d.gz),t.Y36(d.F0),t.Y36(A.Ye),t.Y36(A.K0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-transaction-import-filter"]],viewQuery:function(o,e){if(1&o&&t.Gf(lt,5),2&o){let a;t.iGM(a=t.CRH())&&(e.submitHelpBlock=a.first)}},decls:23,vars:5,consts:function(){let n;return n=$localize`Filter`,[[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-12"],[1,"table-responsive-xl"],[1,"table","table-sm","table-bordered","small","font-weight-lighter","text-truncate"],["id","parsedData"],[1,"align-middle"],[4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-primary",3,"disabled"],n,["id","submitHelpBlock",1,"form-text","text-muted"],["submitHelpBlock",""],["title","columnType",1,"form-select",3,"id"],["class","w-auto",3,"value",4,"ngFor","ngForOf"],[1,"w-auto",3,"value"],[1,"custom-control","custom-checkbox","text-center"],["title","ignore","type","checkbox","checked","",1,"custom-control-input",3,"id"],[1,"custom-control-label",3,"for"]]},template:function(o,e){1&o&&(t.TgZ(0,"h2"),t._uU(1,"Filter transactions"),t.qZA(),t._UZ(2,"br"),t.TgZ(3,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit(e.form.value)}),t.TgZ(4,"div",1)(5,"div",2)(6,"div",3)(7,"table",4)(8,"tbody",5)(9,"tr")(10,"th",6),t._uU(11," Import? "),t.qZA(),t.YNc(12,Tt,3,2,"th",7),t.qZA(),t.YNc(13,Nt,6,3,"tr",7),t.qZA()()()()(),t._UZ(14,"br"),t.TgZ(15,"div",1)(16,"div",2)(17,"button",8),t.SDv(18,9),t.qZA(),t.TgZ(19,"small",10,11),t._uU(21,"Classify each relevant column"),t.qZA()()()(),t._UZ(22,"br")),2&o&&(t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(9),t.Q6J("ngForOf",null==e.transactions||0==e.transactions.length?t.DdM(4,pt):e.transactions[0]),t.xp6(1),t.Q6J("ngForOf",e.transactions),t.xp6(4),t.Q6J("disabled",e.submitDisabled))},dependencies:[A.sg,c._Y,c.YN,c.Kr,c.JL,c.sg,ct.P]}),r})();function At(r,i){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"category"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"transaction"),t.qZA()()),2&r){const s=i.$implicit;t.xp6(2),t.hij(" ",t.xi3(3,5,s.date,"shortDate")," "),t.xp6(3),t.hij(" ",null==s.entity?"":s.entity.name," "),t.xp6(2),t.hij(" ",null==s.category?"":t.lcZ(8,8,s.category)," "),t.xp6(3),t.hij(" ",s.description," "),t.xp6(2),t.hij(" ",t.lcZ(13,10,s)," ")}}let mt=(()=>{const i=class{constructor(n,o,e,a,T){this.accountService=n,this.transactionService=o,this.formBuilder=e,this.route=a,this.router=T,this.account=null,this.transactions=null,this.submitDisabled=!1,this.formData={importData:null},this.form=this.formBuilder.group(this.formData)}ngOnInit(){this.account=null,this.transactions=this.transactionService.filterTransactions,this.route.paramMap.subscribe(n=>{var o=n.get("accountId");null!=o&&(this.account=this.accountService.getAccount(o),null==this.account?this.router.navigate([""]):(null==this.transactions||0==this.transactions.length)&&(alert("No transactions to edit"),this.router.navigate(["/transactions/import/"+this.account.id])))})}onSubmit(n){null!=this.account&&null!=this.transactions?(this.transactions.forEach(o=>{null!=this.account&&this.transactionService.createTransaction(this.account,o.amount,o.date,o.type,null==o.entity?"":o.entity.name,null==o.category?"":o.category.name,o.receiptReference,o.description)}),this.form.reset(),this.accountService.selectAccount(this.account),this.router.navigate(["/transactions/"+this.account.id])):(console.error("No account selected"),this.router.navigate(["/accounts"]))}};let r=i;return i.\u0275fac=function(o){return new(o||i)(t.Y36(O.B),t.Y36(h.p),t.Y36(c.QS),t.Y36(d.gz),t.Y36(d.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-transaction-import-edit"]],decls:27,vars:3,consts:function(){let n,o,e,a,T,u;return n=$localize`Date`,o=$localize`Entity`,e=$localize`Category`,a=$localize`Description`,T=$localize`Amount`,u=$localize` Import `,[[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-12"],[1,"table-responsive-xl"],[1,"table","table-sm","table-bordered","small","font-weight-lighter","text-truncate"],["id","parsedData"],n,o,e,a,T,[4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-primary",3,"disabled"],u]},template:function(o,e){1&o&&(t.TgZ(0,"h2"),t._uU(1,"Edit transactions"),t.qZA(),t._UZ(2,"br"),t.TgZ(3,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit(e.form.value)}),t.TgZ(4,"div",1)(5,"div",2)(6,"div",3)(7,"table",4)(8,"tbody",5)(9,"tr")(10,"th"),t.SDv(11,6),t.qZA(),t.TgZ(12,"th"),t.SDv(13,7),t.qZA(),t.TgZ(14,"th"),t.SDv(15,8),t.qZA(),t.TgZ(16,"th"),t.SDv(17,9),t.qZA(),t.TgZ(18,"th"),t.SDv(19,10),t.qZA()(),t.YNc(20,At,14,12,"tr",11),t.qZA()()()()(),t._UZ(21,"br"),t.TgZ(22,"div",1)(23,"div",2)(24,"button",12),t.SDv(25,13),t.qZA()()()(),t._UZ(26,"br")),2&o&&(t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(17),t.Q6J("ngForOf",e.transactions),t.xp6(4),t.Q6J("disabled",e.submitDisabled))},dependencies:[A.sg,c._Y,c.JL,c.sg,A.uU,D.M,y.y]}),r})();var E=_(3391),dt=_(8529);function gt(r,i){if(1&r&&(t.TgZ(0,"option",36),t._uU(1),t.ALo(2,"transactionType"),t.qZA()),2&r){const s=i.$implicit,n=t.oxw();t.Q6J("selected",n.form.value.type==s)("value",s),t.xp6(1),t.Oqu(t.lcZ(2,3,s))}}function ht(r,i){if(1&r&&(t.TgZ(0,"option",36),t._uU(1),t.qZA()),2&r){const s=i.$implicit,n=t.oxw();t.Q6J("selected",s.id==n.form.value.accountId)("value",s.id),t.xp6(1),t.Oqu(s.name)}}function Ot(r,i){if(1&r&&(t.TgZ(0,"option",37),t._uU(1),t.qZA()),2&r){const s=i.$implicit;t.Q6J("value",s.name),t.xp6(1),t.Oqu(s.name)}}function Ct(r,i){if(1&r&&(t.TgZ(0,"option",37),t._uU(1),t.qZA()),2&r){const s=i.$implicit;t.Q6J("value",s.name),t.xp6(1),t.Oqu(s.name)}}function ft(r,i){if(1&r){const s=t.EpF();t.TgZ(0,"a",38),t.NdJ("click",function(){t.CHM(s);const o=t.oxw();return t.KtG(o.onDelete(o.form.value.accountId,o.form.value.id))}),t.SDv(1,39),t.qZA()}}const R=function(){return[]};let v=(()=>{const i=class{constructor(n,o,e,a,T,u,N,S,m){this.eventsService=n,this.banknService=o,this.accountService=e,this.transactionService=a,this.formBuilder=T,this.route=u,this.router=N,this.location=S,this.mathService=m,this.transactionTypes=Object.values(p.iU),this.form=new c.nJ({accountId:new c.p4(null),id:new c.p4(null),amount:new c.p4,day:new c.p4,month:new c.p4,year:new c.p4,type:new c.p4,entity:new c.p4,category:new c.p4,receiptReference:new c.p4,description:new c.p4}),this.accounts=null,this.entities=null,this.categories=null,this.transaction=null}ngOnInit(){this.refreshAccounts(),this.refreshCategories(),this.refreshEntities(),this.eventsService.accountsChange.subscribe(()=>this.refreshAccounts()),this.eventsService.entitiesChange.subscribe(()=>this.refreshEntities()),this.eventsService.categoriesChange.subscribe(()=>this.refreshCategories()),this.route.paramMap.subscribe(n=>{if(null!=this.accounts){var o,e=n.get("accountId");if(null==e||0==e.trim().length){var a=this.accountService.getSelectedAccounts();o=a.length>0?a[0]:this.accounts[0]}else o=this.accountService.getAccount(e);if(null!=o){var T=n.get("transactionId");if(null==T||0==T.trim().length){var u=new Date;this.form.setValue({accountId:o.id,id:null,amount:E.n.toInputValue(this.accountService.toDinero(0,o)),day:u.getDate(),month:u.getMonth()+1,year:u.getFullYear(),type:p.iU.DEBIT.toString(),entity:"",category:"",receiptReference:"",description:""})}else this.transaction=this.transactionService.getTransaction(o,T),null!=this.transaction?this.form.setValue({accountId:o.id,id:T,amount:E.n.toInputValue(this.transaction.amount),day:this.transaction.date.getDate(),month:this.transaction.date.getMonth()+1,year:this.transaction.date.getFullYear(),type:this.transaction.type.toString(),entity:null==this.transaction.entity?"":this.transaction.entity.name,category:null==this.transaction.category?"":this.transaction.category.name,receiptReference:this.transaction.receiptReference,description:this.transaction.description}):(console.error("No transaction with that id"),this.router.navigate(["/transactions"]))}else console.error("No account with that id"),this.router.navigate(["/accounts"])}})}refreshAccounts(){this.accounts=this.accountService.getAccounts()}refreshEntities(){this.entities=this.banknService.getBankn().entities}refreshCategories(){this.categories=this.banknService.getBankn().categories}onSubmit(){var n=this.accountService.getAccount(this.form.controls.accountId.value);if(null!=n){var o=this.accountService.fromInputValue(this.form.controls.amount.value,n),e=new Date(0);e.setFullYear(this.form.controls.year.value,this.form.controls.month.value-1,this.form.controls.day.value),null==this.form.controls.id.value?this.transactionService.createTransaction(n,o,e,this.form.controls.type.value,this.form.controls.entity.value,this.form.controls.category.value,this.form.controls.receiptReference.value,this.form.controls.description.value):null!=this.transaction&&this.transactionService.updateTransaction(n,this.transaction,o,e,this.form.controls.type.value,this.form.controls.entity.value,this.form.controls.category.value,this.form.controls.receiptReference.value,this.form.controls.description.value),this.form.reset(),this.router.navigate(["/transactions"])}else alert("Error, try again.")}onDelete(n,o){this.transactionService.deleteTransactionId(n,o),this.location.back()}onCancel(){this.location.back()}};let r=i;return i.\u0275fac=function(o){return new(o||i)(t.Y36(I.n),t.Y36(M.D),t.Y36(O.B),t.Y36(h.p),t.Y36(c.QS),t.Y36(d.gz),t.Y36(d.F0),t.Y36(A.Ye),t.Y36(E.n))},i.\u0275cmp=t.Xpm({type:i,selectors:[["transaction"]],decls:68,vars:11,consts:function(){let n,o,e,a,T,u,N,S,m,g,C,P,f;return n=$localize`Type`,o=$localize`Amount`,e=$localize`Account`,a=$localize`Date`,T=$localize`Entity`,u=$localize`Edit`,N=$localize`Category`,S=$localize`Edit`,m=$localize`Receipt #`,g=$localize`Description`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION:`,P=$localize`Cancel`,f=$localize`Delete`,[[1,"container",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-6","form-group"],[1,"input-group"],[1,"input-group-text"],n,["title","type","formControlName","type",1,"form-select"],[3,"selected","value",4,"ngFor","ngForOf"],o,["title","amount","id","amount","type","text","formControlName","amount",1,"form-control"],e,["title","account","formControlName","accountId",1,"form-select"],a,["type","text","aria-label","day","formControlName","day","id","day",1,"form-control"],["type","text","aria-label","month","formControlName","month","id","month",1,"form-control"],["type","text","aria-label","year","formControlName","year","id","year",1,"form-control"],T,["title","entity","type","text","id","entity","list","entityList","formControlName","entity",1,"form-select"],["id","entityList"],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-outline-secondary"],u,N,["title","category","type","text","id","category","list","categoryList","formControlName","category",1,"form-select"],["id","categoryList"],S,m,["title","receipt #","type","text","id","receiptReference","formControlName","receiptReference",1,"form-control"],[1,"col-sm-12","col-12","form-group"],g,["title","description","id","description","formControlName","description",1,"form-control"],["type","submit",1,"btn","btn-primary"],C,["class","btn btn-danger text-white","role","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],P,[3,"selected","value"],[3,"value"],["role","button",1,"btn","btn-danger","text-white",3,"click"],f]},template:function(o,e){1&o&&(t.TgZ(0,"h2"),t._uU(1),t.qZA(),t._UZ(2,"br"),t.TgZ(3,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit()}),t.TgZ(4,"div",1)(5,"div",2)(6,"div",3)(7,"span",4),t.SDv(8,5),t.qZA(),t.TgZ(9,"select",6),t.YNc(10,gt,3,5,"option",7),t.qZA()()(),t.TgZ(11,"div",2)(12,"div",3)(13,"span",4),t.SDv(14,8),t.qZA(),t._UZ(15,"input",9),t.qZA()()(),t.TgZ(16,"div",1)(17,"div",2)(18,"div",3)(19,"span",4),t.SDv(20,10),t.qZA(),t.TgZ(21,"select",11),t.YNc(22,ht,2,3,"option",7),t.qZA()()(),t.TgZ(23,"div",2)(24,"div",3)(25,"span",4),t.SDv(26,12),t.qZA(),t._UZ(27,"input",13)(28,"input",14)(29,"input",15),t.qZA()()(),t.TgZ(30,"div",1)(31,"div",2)(32,"div",3)(33,"span",4),t.SDv(34,16),t.qZA(),t._UZ(35,"input",17),t.TgZ(36,"datalist",18),t.YNc(37,Ot,2,2,"option",19),t.qZA(),t.TgZ(38,"button",20),t.SDv(39,21),t.qZA()()(),t.TgZ(40,"div",2)(41,"div",3)(42,"span",4),t.SDv(43,22),t.qZA(),t._UZ(44,"input",23),t.TgZ(45,"datalist",24),t.YNc(46,Ct,2,2,"option",19),t.qZA(),t.TgZ(47,"button",20),t.SDv(48,25),t.qZA()()()(),t.TgZ(49,"div",1)(50,"div",2)(51,"div",3)(52,"span",4),t.SDv(53,26),t.qZA(),t._UZ(54,"input",27),t.qZA()()(),t.TgZ(55,"div",1)(56,"div",28)(57,"div",3)(58,"span",4),t.SDv(59,29),t.qZA(),t._UZ(60,"textarea",30),t.qZA()()(),t.TgZ(61,"button",31),t.SDv(62,32),t.qZA(),t._uU(63," \xa0 "),t.YNc(64,ft,2,0,"a",33),t._uU(65," \xa0 "),t.TgZ(66,"button",34),t.NdJ("click",function(){return e.onCancel()}),t.SDv(67,35),t.qZA()()),2&o&&(t.xp6(1),t.Oqu(null==e.form.value.id?"Create Transaction":"Edit Transaction"),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(7),t.Q6J("ngForOf",e.transactionTypes),t.xp6(12),t.Q6J("ngForOf",null==e.accounts?t.DdM(8,R):e.accounts),t.xp6(15),t.Q6J("ngForOf",null==e.entities?t.DdM(9,R):e.entities),t.xp6(9),t.Q6J("ngForOf",null==e.categories?t.DdM(10,R):e.categories),t.xp6(16),t.pQV(null==e.form.value.id?"Create":"Ok"),t.QtT(62),t.xp6(2),t.Q6J("ngIf",null!=e.form.value.id))},dependencies:[A.sg,A.O5,c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.sg,c.u,dt.b]}),r})();const It=[{path:"",component:b},{path:"transaction",component:v},{path:":accountId",component:b},{path:"transaction/:accountId",component:v},{path:"transaction/:accountId/:transactionId",component:v},{path:"import/:accountId",component:ot},{path:"import-filter/:accountId",component:St},{path:"import-edit/:accountId",component:mt}];let Mt=(()=>{const i=class{};let r=i;return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[d.Bz.forChild(It),d.Bz]}),r})();var Et=_(2271);let Rt=(()=>{const i=class{};let r=i;return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[A.ez,c.u5,c.UX,Mt,Et.m]}),r})()}}]);